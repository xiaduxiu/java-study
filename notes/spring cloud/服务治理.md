#### 为什么要服务治理？

微服务架构中，每一个服务既可以成为服务的提供者，也可以成为服务的消费者，关于服务的消费者如何调用服务的提供者就需要服务治理。

服务治理最基础的功能需求包括了服务注册和服务发现。其本质是由于微服务中每个服务实例因为自动扩容、服务失败和更新等因素导致发生了状态的变化。服务的提供者希望将自己能够自动注册到服务注册中心，服务的消费者希望能自动发现服务提供者发生的变化以及能够远程调用服务。

注册中心是一种服务器组件，服务的提供者和服务的消费者对注册中心而言都是客户端。

#### 服务治理的模型

访问注册中心的客户端程序都会嵌入到服务的提供者和服务的消费者内部。服务提供者通过其内部的注册中心客户端程序自动将自身注册到注册中心，服务消费者通过内部的注册中心客户端从注册中心获取到那些已经注册的服务实例信息。同时为了提高服务路由的效率和容错性，服务消费者利用本地缓存路由提高服务路由的速度以及保证服务的可靠调用。

#### 服务治理的实现策略

实现策略有推拉两种。

1. 采用发布-订阅模式，服务提供者发布服务，服务消费者订阅自己感兴趣的服务，在服务变更时，注册中心能主动推送变更到订阅了此服务的消费者。基于发布-订阅的思想，有了服务监听机制。服务监听是一种被动接收变更的方案，其原理是：通过监听器监听所有的服务提供者，当服务提供者发生变更触发回调方法，消费者接收变更。
2. 轮询机制也可以实现状态信息同步。轮询机制是主动拉取的策略，服务消费者定期调用注册中心提供的服务获取接口获取最新的服务列表并更新本地缓存。
3. 前者代表框架是zookeeper。zookeeper是一个树形结构，在树上创建临时节点，并对节点添加监听器。临时节点的客户端关注该节点的状态，一旦发生变化则通过监听器回传消息到客户端，然后客户端的回调函数就会呗得到调用。后者代表框架是Eureka.采用轮询机制进行服务实例状态的同步，默认同步频率是30秒。

#### 服务治理和负载均衡的关系

​	对于服务发现环节，有两种实现方式，一种是客户端发现机制，一种是服务端发现机制。主流使用客户端发现机制，即在每个服务消费者内部都保存有一个服务列表，当需要对服务提供者远程调用时，需要决定具体的服务提供者实例，此时需要负载均。

​	

